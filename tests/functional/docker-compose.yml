services:

  fastapi:
    build: ./fastapi-service
    image: fastapi-image
    restart: always
    env_file:
      - .env
    ports:
      - 8000:8000

  tests:
      image: fastapi-image
      entrypoint: >
        sh -c "pip install -r /tests/functional/requirements.txt
        && python3 /tests/functional/utils/wait_for_es.py
        && python3 /tests/functional/utils/wait_for_redis.py
        && pytest /tests/functional/src"
