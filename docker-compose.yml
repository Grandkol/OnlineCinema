services:

  etl:
    tty: true
    container_name: etl
    image: etl_image
    build:
      context: /home/stupenko/python/my_app/new_admin_panel_sprint_3/app/
      dockerfile: /home/stupenko/python/my_app/new_admin_panel_sprint_3/app/Dockerfile
    depends_on: 
      - redis
      - elasticsearch
      - postgres
    env_file: /home/stupenko/python/my_app/new_admin_panel_sprint_3/app/.env.dist
    networks:
      - my_network

  redis:
    container_name: redis
    image: redis:latest
    ports:
      - 6379:6379
    networks:
      - my_network
    restart: on-failure

  postgres:
    container_name: postgres
    image: postgres:latest
    environment:
      - POSTGRES_PASSWORD=123
      - POSTGRES_USER=postgres
      - POSTGRES_DB=postgres
    volumes:
      - /home/stupenko/python/my_app/new_admin_panel_sprint_3/database_dump.sql:/docker-entrypoint-initdb.d/database_dump.sql
    networks:
      - my_network
    restart: on-failure

  elasticsearch:
    container_name: elastic
    image: elasticsearch:7.5.2
    environment:
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - discovery.type=single-node
      - xpack.security.enabled=false
    ports:
      - 9200:9200
    networks:
      - my_network
    restart: on-failure

networks:
  my_network:
    name: my_network